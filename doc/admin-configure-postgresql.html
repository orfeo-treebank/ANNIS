<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>ANNIS: PostgreSQL Server Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="annis_64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ANNIS
   &#160;<span id="projectnumber">3.2.3</span>
   </div>
   <div id="projectbrief">An open source, versatile web browser-based search and visualization architecture for complex multilevel linguistic corpora with diverse types of annotation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('admin-configure-postgresql.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PostgreSQL Server Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#admin-configure-postgresperf">Performance tuning </a></li>
<li class="level1"><a href="#admin-configure-logging">Logging </a></li>
<li class="level1"><a href="#admin-configure-remote">Remote access </a></li>
<li class="level1"><a href="#admin-configure-res">Configuration of System Resources </a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="admin-configure-postgresperf"></a>
Performance tuning </h1>
<p>The default configuration of PostgreSQL uses system resource very sparingly. To improve the performance of the ANNIS service it is necessary to change a few settings in the PostgreSQL configuration file <code>postgresql.conf</code> as shown in the excerpt below.</p>
<p>Most of the options below are commented out in the <code>postgresql.conf</code> file. This means that PostgreSQL will use the default value, i.e. the value as it appears in the <code>postgresql.conf</code> file, for this option. To make your changes take effect you have to uncomment it.</p>
<p>The values below are for machine with 2 GB RAM that is exclusively dedicated to running PostgreSQL. If you're running ANNIS on your local machine and don't have large corpora, you should use lower values as explained in the comments.</p>
<p>Changes in <code>postgresql.conf</code>:</p>
<pre class="fragment">max_connections = 100        # expected maximum number of connections (users) at peak load

shared_buffers = 512MB      # RAM cache shared across all sessions
                            # 25% of available RAM
                            # use lower value on a desktop system, i.e. 128MB or 256MB

work_mem = 128MB            # RAM for *one* sort, aggregate or hash operation inside a query plan 
                            # RAM / (2 x max_connections)
                            # (many operations can run in parallel!)
                            # increase for large corpora, i.e. 256MB, 512MB
                            # decrease if you have many users

maintenance_work_mem = 256MB    # RAM for maintenance operations during corpus import
                                # CREATE INDEX, VACUUM etc.
                                # increase for large corpora

effective_cache_size = 1536MB   # estimated size of disk cached used by the OS
                                # 75% of available RAM
                                # use lower value on a desktop system, where other applications are running
                                # e.g. 512MB for a desktop with 2 GB RAM

default_statistcs_target = 100      # size of value histogram for each table column
                                    # use maximum value

checkpoint_segments = 20    # affects how quickly buffers are written
                            # to disk inside a transaction

autovacuum = off        # VACUUM is done automatically during corpus import
</pre><p>More information on these settings can be found in the PostgreSQL manual:</p>
<ul>
<li>"18.4. Resource Consumption": <a href="http://www.postgresql.org/docs/9.2/interactive/runtime-config-resource.html">http://www.postgresql.org/docs/9.2/interactive/runtime-config-resource.html</a></li>
<li>"18.5. Write Ahead Log": <a href="http://www.postgresql.org/docs/9.2/interactive/runtime-config-wal.html">http://www.postgresql.org/docs/9.2/interactive/runtime-config-wal.html</a></li>
<li>"18.6. Query Planning": <a href="http://www.postgresql.org/docs/9.2/interactive/runtime-config-query.html">http://www.postgresql.org/docs/9.2/interactive/runtime-config-query.html</a></li>
<li>"28.4. WAL Configuration": <a href="http://www.postgresql.org/docs/9.2/interactive/wal-configuration.html">http://www.postgresql.org/docs/9.2/interactive/wal-configuration.html</a></li>
<li>"PostgreSQL Wiki": <a href="http://wiki.postgresql.org/wiki/SlowQueryQuestions">http://wiki.postgresql.org/wiki/SlowQueryQuestions</a></li>
</ul>
<h1><a class="anchor" id="admin-configure-logging"></a>
Logging </h1>
<p>If you want to log the duration of SQL statements you should also set the following options in <code>postgresql.conf</code>:</p>
<pre class="fragment">log_min_duration_statement = 0
</pre><h1><a class="anchor" id="admin-configure-remote"></a>
Remote access </h1>
<p>If the PostgreSQL server runs on a separate machine, remote access has to be enabled.</p>
<p>Changes in <code>postgresql.conf</code>:</p>
<pre class="fragment">listen_adresses = 'localhost,192.168.1.1'
</pre><p> Where 192.168.1.1 is the IP address of the machine running PostgreSQL.</p>
<p>Changes in <code>pg_hba.conf</code>:</p>
<pre class="fragment">host annis_db annis_user 192.168.1.2/0 md5
</pre><p> Where 192.168.1.2 is the machine running the ANNIS service that is connecting to the remote PostgreSQL server.</p>
<h1><a class="anchor" id="admin-configure-res"></a>
Configuration of System Resources </h1>
<p>PostgreSQL needs to access large areas of continuous RAM which can easily exceed the maximum size allowed by the operating system. PostgreSQL will check the OS resource settings during startup and exit with an error if they are not adequate.</p>
<p>Reproduced below are the commands to change the resource settings on Linux and OS X. More information can be found in the PostgreSQL manual: <a href="http://www.postgresql.org/docs/8.3/interactive/kernel-resources.html 17.4.">Managing Kernel Resources</a>.</p>
<h2>Linux</h2>
<pre class="fragment">sysctl -w kernel.shmmax=536870912   # bytes; corresponds to 512MB
</pre><p> This command takes effect immediately. To make the change permanent across system reboots, add it to the file <code>/etc/sysctl.conf</code>.</p>
<h2>Mac OS X</h2>
<pre class="fragment">sysctl -w kern.sysv.shmmax=536870912        # bytes; corresponds to 512MB
sysctl -w kern.sysv.shmall=131072           # measured in 4 kB pages
</pre><p> OS X has to be rebooted for the command to take effect. To make the change permanent across system reboots, add it to the file <code>/etc/sysctl.conf</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="admin.html">Administration</a></li>
    <li class="footer">Generated on Tue Apr 14 2015 15:38:44 for ANNIS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
