<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>ANNIS: Upgrading an ANNIS installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="annis_64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ANNIS
   &#160;<span id="projectnumber">3.2.3</span>
   </div>
   <div id="projectbrief">An open source, versatile web browser-based search and visualization architecture for complex multilevel linguistic corpora with diverse types of annotation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('admin-upgrade.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Upgrading an ANNIS installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#admin-upgrade-minor">Upgrade for minor version updates </a></li>
<li class="level1"><a href="#admin-upgrade-full">Full upgrade </a></li>
</ul>
</div>
<div class="textblock"><p>These instructions are a guideline for upgrading the installation of ANNIS on a UNIX-like server. If you use the <a class="el" href="admin-install.html#admin-install-kickstarter">local ANNIS Kickstarter version</a> just download the new version and re-initialize the database. Please read <a class="el" href="admin-install.html#admin-install-server">the installation instructions</a> first if you haven't done so yet. The upgrade path described here tries to have a minimum downtime.</p>
<h1><a class="anchor" id="admin-upgrade-minor"></a>
Upgrade for minor version updates </h1>
<p>For minor version updates, e.g. from 3.1.0 to 3.1.1 (thus only the last version number changes) you can use the database from the older version without any modifications. Thus an upgrade only consists of the following steps</p>
<ol type="1">
<li>backup the old installation files</li>
<li>download the files of the new version</li>
<li>backup the <code>conf/database.properties</code> file of the ANNIS service</li>
<li>if you made any manual adjustments to the file <code>conf/annis-service.properties</code> also backup it</li>
<li>stop the old ANNIS service</li>
<li>overwrite the files of the old ANNIS service installation with the new version</li>
<li>overwrite the <code>conf/database.properties</code> file with the backup</li>
<li>apply the changes you made to the <code>conf/annis-service.properties</code> on the new version (e.g. set the port number)</li>
<li>start the ANNIS service again</li>
<li>undeploy the old WAR file and deploy the new WAR file</li>
</ol>
<h1><a class="anchor" id="admin-upgrade-full"></a>
Full upgrade </h1>
<p>Whenever the first or second number of the version changes you have to re-import the corpora into a newly initialized database.</p>
<h2>1. Download </h2>
<p>Download both the <code>annis-service-&lt;VERSION&gt;.tar.gz</code> and the <code>annis-gui-&lt;VERSION&gt;.war</code> to a folder of your choice, e.g. <code>/tmp/</code>.</p>
<h2>2. Install the new service </h2>
<p>Unzip the annis service to a new directory (don't delete or stop the old service) and install it. These steps are similiar to how to <a class="el" href="admin-install.html#admin-install-server">install a new ANNIS service</a>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;tar xvzf /tmp/annis-service-&lt;VERSION&gt;.tar.gz -C &lt;new installation directory&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export ANNIS_HOME=&lt;new installation directory&gt;&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export PATH=$PATH:$ANNIS_HOME/bin</div>
</div><!-- fragment --><p> If you made any manual changes to the <code>conf/annis-service.properties</code> file copy the changes to the new installation. Then initialize the the database for the new installation. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;annis-admin.sh init -u &lt;username&gt; -d &lt;dbname&gt; -p &lt;user password&gt; --schema &lt;new schema name&gt;</div>
</div><!-- fragment --><p> Please re-use the old database name, the user name and the password for the existing user (they can be found in the <code>conf/database.properties</code> file of the old installation). The parameter <code>--schema</code> allows you to define a new <a href="http://www.postgresql.org/docs/9.1/static/ddl-schemas.html">PostgreSQL schema</a> which will be used for the new installation. A good name could be something like "v32" if the version is 3.2.0.</p>
<h2>3. Copy old corpora </h2>
<p>With the command </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;annis-admin.sh copy &lt;old installation director&gt;/conf/database.properties</div>
</div><!-- fragment --><p> the existing corpora of the old installation will be imported. This can take a long time, so if you use SSH you might want use <code>nohup</code> to make sure the process will continue to run in the background even if the connection is interrupted. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;nohup annis-admin.sh copy &lt;old installation director&gt;/conf/database.properties &amp;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;tail -f nohup.out</div>
</div><!-- fragment --><p> At the end a summary of all successfull and failed imports will be given. If there where any errors please try to import the corpus manually. When all corpora are imported, proceed to the next step.</p>
<h2>4. Switch service </h2>
<p>Stop the old service and start the new service. Remember to set the <code>ANNIS_HOME</code> variable to the right value in both cases before you call <code>annis-service.sh start/stop</code> command.</p>
<h2>5. Upgrade front-end </h2>
<p>Undeploy the old WAR file and deploy the new WAR file.</p>
<h2>6. Cleanup </h2>
<p>If everything works as expected you can delete the old installation files. You should also remove the contents of the old database by deleting the schema from the PostgreSQL client: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;DROP SCHEMA &lt;oldschema&gt;;</div>
</div><!-- fragment --><p>To delete all unused external data files execute </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;annis-admin.sh cleanup-data</div>
</div><!-- fragment --> <dl class="section warning"><dt>Warning</dt><dd>This will delete all data files not known to the current instance of ANNIS. If you have multiple parallel installations and did not use different values for the <code>annis.external-data-path</code> variable in the <code>conf/annis-service.properties</code> the data files of the other installations will be lost. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="admin.html">Administration</a></li>
    <li class="footer">Generated on Tue Apr 14 2015 15:38:44 for ANNIS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
